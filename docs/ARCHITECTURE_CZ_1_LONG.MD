Návrh architektúry mikroservisov pre systém TransitPay

Prehľad:
TransitPay bude navrhnutý ako cloud-native mikroservisná architektúra s dôrazom na princíp single-responsibility (každý komponent má jasne definovanú jednu zodpovednosť). Komunikácia medzi službami bude udalostne riadená (event-driven) cez Azure Service Bus, čo zabezpečí voľné prepojenie (loose coupling) a asynchrónnu výmenu správ. Frontend aplikácie bude implementovaný v Blazor WebAssembly (SPA v prehliadači) a backend mikroservisy v .NET, s využitím .NET Aspire na orchestráciu a lokálny beh distribuovaných komponentov počas vývoja. Nasadenie prebehne v kontajneroch orchestrovaných cez Kubernetes (napr. Azure Kubernetes Service) pre zabezpečenie škálovateľnosti a vysokej dostupnosti.

Mikroservisy a ich zodpovednosti:
Navrhované mikroservisy v súlade s doménou TransitPay (platby za verejnú dopravu) sú definované tak, aby každý plnil jednu hlavnú funkciu. Názvy služieb odrážajú ich biznis účel podľa osvedčených postupov Microsoftu (napr. UserService, OrderService, atď.):

- **Identity (Autentizácia a autorizácia)**: Zabezpečuje správu identity používateľov – prihlasovanie, registráciu a vydávanie tokenov. Integruje sa s Azure AD B2C alebo inou identitnou platformou pre jednotné prihlásenie.
- **User Profile (Správa používateľov)**: Udržuje profilové údaje cestujúcich (meno, kontakty, preferencie) a prípadné zákaznícke nastavenia. Plne zodpovedá za dáta používateľov a neprekrýva sa s inými službami.
- **Trip Management (Správa jázd)**: Spracováva udalosti súvisiace s jazdou cestujúceho. Pri “check-in”/“check-out” (nastúpení/vystúpení) vytvorí záznam o jazde, sleduje trasu alebo zóny pre danú jazdu a na konci publikuje udalosť o ukončení jazdy s detailmi (napr. ubehnutá vzdialenosť, zóny).
- **Fare Calculation (Výpočet cestovného)**: Zodpovedá za výpočet ceny cestovného na základe údajov o jazde (vstupné dáta z Trip Management). Po prijatí udalosti o ukončení jazdy vypočíta tarifnú cenu podľa obchodných pravidiel (napr. vzdialenosť, čas, zóny, typ cestujúceho) a publikuje udalosť FareCalculated s požadovanou sumou platby.
- **Payment Processing (Spracovanie platieb)**: Zabezpečuje finančné transakcie. Po prijatí udalosti s požiadavkou na platbu (sumou) vykoná ACID transakciu vo svojej databáze – napr. odpočíta kredit z účtu cestujúceho alebo zrealizuje platbu cez externú platobnú bránu. Integruje sa s platobnými systémami (napr. Stripe/PayPal API) a garantuje konzistenciu – ak platba prebehne, uloží záznam o transakcii a publikuje udalosť PaymentCompleted (prípadne PaymentFailed ak zlyhá).
- **Notification (Notifikačný servis)**: Má na starosti odosielanie notifikácií a potvrdení. Po úspešnej platbe odoberie udalosť PaymentCompleted a napr. zašle cestujúcemu elektronický lístok alebo potvrdenku (email/SMS/push). Taktiež môže reagovať na iné udalosti (napr. nízky zostatok na konte) a posielať upozornenia.
- **API Gateway (brána rozhraní)**: Hoci nejde o “biznis” mikroservis, je to dôležitá súčasť architektúry. Poskytne jednotný vstupný bod pre front-end (Blazor WASM) a externé klienty. Realizuje autorizáciu, routing na jednotlivé backend služby a prípadnú agregáciu dát. V Azure prostredí to môže byť implementované cez Azure API Management alebo inverzný proxy (napr. YARP) nasadený v AKS. Týmto spôsobom klient (Blazor aplikácia) komunikuje cez gateway namiesto priameho volania množstva služieb.

(Pozn.: Každý mikroservis má vlastnú databázu, optimalizovanú pre jeho potreby. Napríklad Payment má relačnú DB kvôli transakciám, Trip/Fare môžu využívať rýchle úložisko na čítanie jázd a taríf atď. Žiadne dve služby nezdieľajú spoločnú databázovú schému, čím sa predíde úzkemu prepojeniu a zlepší nezávislosť nasadzovania.)

Event-driven komunikácia s Azure Service Bus:
Mikroservisy nekomunikujú priamo synchronnými REST volaniami, namiesto toho využívajú publikovanie a odoberanie udalostí cez Azure Service Bus (pub/sub model). Pri zmenách stavov (napr. ukončenie jazdy, dokončenie výpočtu ceny, úspešná platba) mikroservisy publikujú integračné eventy, ktoré sú asynchrónne spracované inými službami. Táto udalostne riadená architektúra zabezpečuje, že služby sú voľne naviazané – napríklad Fare Calculation nevie kto odoberá výsledok výpočtu, len pošle správu do Service Bus, odkiaľ si ju Payment služba prevezme.

Azure Service Bus slúži ako spoľahlivý sprostredkovateľ správ (message broker) v cloude. Podporuje fronty aj topics (s subscription pre pub/sub), takže viaceré služby môžu odoberať konkrétne typy udalostí. Poskytuje aj pokročilé funkcie ako transakcie (atomické operácie s viacerými správami) a správy dead-letter (nevybavené správy uložené bokom), čo pomáha budovať odolný a spoľahlivý systém.

Zhrnutie:
TransitPay architektúra stavia na osvedčených princípoch Microsoftu pre mikroservisy – jasná zodpovednosť každej služby, konzistentné názvy podľa domény, asynchrónne prepojenie cez Azure Service Bus a dôraz na škálovateľnosť (AKS) a spoľahlivosť (ACID v rámci služby, eventual consistency medzi nimi). Zároveň však platí, že architektúru treba neustále vyhodnocovať a prispôsobiť reálnym potrebám – ak by počet mikroservisov zbytočne zvyšoval komplexnosť či latenciu, je možné niektoré funkcie zlučovať, pokiaľ tým neporušíme zásadu oddelenia koncernov. Moderné architektúry úspešne fungujú aj vďaka tomu, že vedia nájsť balans medzi čistými princípmi a praktickými kompromismi pre daný biznis prípad.